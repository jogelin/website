---
import cv from '../content/cv/cv.json';

const recommendations = cv.recommendations.slice(0, 4);
---

<div class="recommendations-container">
  <div class="section-header">
    <span class="section-label">Testimonials</span>
    <h2 class="section-title">What People Say</h2>
  </div>

  <div class="testimonials-carousel">
    <div class="testimonials-wrapper">
      {
        recommendations.map((rec, index) => (
          <div class:list={['testimonial-slide', { active: index === 0 }]} data-index={index}>
            <div class="recommendation-card">
              <div class="quote-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z" />
                </svg>
              </div>
              <p class="recommendation-content">
                {rec.content.split('\n').map((line) => (
                  <>
                    {line}
                    <br />
                  </>
                ))}
              </p>
              <div class="recommendation-author">
                <img src={rec.picture} alt={`${rec.name}'s picture`} class="author-image" />
                <div class="author-info">
                  <h4 class="author-name">{rec.name}</h4>
                  <p class="author-role">{rec.role}</p>
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>

    <button class="carousel-button prev" aria-label="Previous recommendation">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    <button class="carousel-button next" aria-label="Next recommendation">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M9 5l7 7-7 7" />
      </svg>
    </button>

    <div class="carousel-dots">
      {recommendations.map((_, index) => <button class:list={['dot', { active: index === 0 }]} data-index={index} aria-label={`Go to recommendation ${index + 1}`} />)}
    </div>
  </div>

  <div class="view-all">
    <a href="/cv#recommendations" class="view-all-link">
      View all {cv.recommendations.length} recommendations
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M9 5l7 7-7 7"></path>
      </svg>
    </a>
  </div>
</div>

<script>
  let currentIndex = 0;
  const slides = document.querySelectorAll('.testimonial-slide');
  const dots = document.querySelectorAll('.carousel-dots .dot');
  const prevButton = document.querySelector('.carousel-button.prev');
  const nextButton = document.querySelector('.carousel-button.next');

  function showSlide(index: number) {
    slides.forEach((slide, i) => {
      slide.classList.toggle('active', i === index);
    });
    dots.forEach((dot, i) => {
      dot.classList.toggle('active', i === index);
    });
    currentIndex = index;
  }

  function nextSlide() {
    const next = (currentIndex + 1) % slides.length;
    showSlide(next);
  }

  function prevSlide() {
    const prev = (currentIndex - 1 + slides.length) % slides.length;
    showSlide(prev);
  }

  prevButton?.addEventListener('click', prevSlide);
  nextButton?.addEventListener('click', nextSlide);

  dots.forEach((dot) => {
    dot.addEventListener('click', (e) => {
      const index = parseInt((e.target as HTMLElement).dataset.index || '0');
      showSlide(index);
    });
  });

  setInterval(nextSlide, 8000);
</script>

<style>
  .recommendations-container {
    max-width: 900px;
    margin: 0 auto;
  }

  .section-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .section-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: rgba(16, 185, 129, 0.7);
    display: block;
    margin-bottom: 8px;
  }

  .section-title {
    font-size: clamp(28px, 4vw, 36px);
    font-weight: 700;
    color: #10b981;
  }

  .testimonials-carousel {
    position: relative;
  }

  .testimonials-wrapper {
    position: relative;
    min-height: 320px;
  }

  .testimonial-slide {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.5s ease;
    pointer-events: none;
  }

  .testimonial-slide.active {
    opacity: 1;
    pointer-events: auto;
  }

  .recommendation-card {
    background: rgba(16, 185, 129, 0.05);
    border: 1px solid rgba(16, 185, 129, 0.2);
    border-radius: 16px;
    padding: 32px;
    min-height: 280px;
    display: flex;
    flex-direction: column;
  }

  .quote-icon {
    width: 32px;
    height: 32px;
    color: rgba(16, 185, 129, 0.4);
    margin-bottom: 16px;
  }

  .quote-icon svg {
    width: 100%;
    height: 100%;
  }

  .recommendation-content {
    font-size: 16px;
    line-height: 1.7;
    color: rgba(226, 232, 240, 0.8);
    flex-grow: 1;
    margin-bottom: 24px;
  }

  .recommendation-author {
    display: flex;
    align-items: center;
    gap: 12px;
    border-top: 1px solid rgba(16, 185, 129, 0.15);
    padding-top: 20px;
  }

  .author-image {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(16, 185, 129, 0.3);
  }

  .author-name {
    font-size: 16px;
    font-weight: 600;
    color: #e2e8f0;
    margin-bottom: 2px;
  }

  .author-role {
    font-size: 13px;
    color: rgba(226, 232, 240, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .carousel-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    color: #10b981;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
  }

  .carousel-button:hover {
    background: rgba(16, 185, 129, 0.2);
    transform: translateY(-50%) scale(1.1);
  }

  .carousel-button.prev {
    left: -60px;
  }

  .carousel-button.next {
    right: -60px;
  }

  .carousel-button svg {
    width: 20px;
    height: 20px;
  }

  .carousel-dots {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 24px;
  }

  .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(16, 185, 129, 0.2);
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }

  .dot:hover {
    background: rgba(16, 185, 129, 0.4);
  }

  .dot.active {
    background: #10b981;
  }

  .view-all {
    text-align: center;
    margin-top: 32px;
  }

  .view-all-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #10b981;
    font-size: 15px;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s;
  }

  .view-all-link:hover {
    text-decoration: underline;
  }

  .view-all-link svg {
    width: 18px;
    height: 18px;
  }

  @media (max-width: 1000px) {
    .carousel-button.prev {
      left: -20px;
    }

    .carousel-button.next {
      right: -20px;
    }
  }

  @media (max-width: 600px) {
    .recommendations-container {
      padding: 0 8px;
    }

    .recommendation-card {
      padding: 24px 20px;
      min-height: 300px;
    }

    .carousel-button {
      width: 36px;
      height: 36px;
    }

    .carousel-button.prev {
      left: -8px;
    }

    .carousel-button.next {
      right: -8px;
    }

    .carousel-button svg {
      width: 16px;
      height: 16px;
    }

    .testimonials-wrapper {
      min-height: 380px;
    }

    .recommendation-content {
      font-size: 15px;
    }
  }
</style>
